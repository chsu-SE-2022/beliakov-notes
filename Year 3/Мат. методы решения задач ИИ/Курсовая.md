# Задание
Математические методы решения задач ИИ 
Прочитайте описание данных. 
Обратите внимание на то, какие задачи хотели бы решить специалисты по продажам. Выбирая методы, учитывайте это. 
Опишите данные и методы, которые использовались в вашей работе, сделайте акцент на цели применения, интерпретации результатов 
1. Познакомьтесь с данными своего задания (кейса) 
	1. Описание данных: опишите виды признаков, закономерности, которые их касаются и используются /предполагаются к использованию в работе (2-10 баллов) 
	2. Формирование своих признаков (2-10 баллов) 
	3. Сформулируйте возможные задачи машинного обучения, возможные к использованию методы, планируемые результаты. Постановка задачи & обоснованные предположения об используемых методах (2-10 баллов) Ими могут быть: 
		1. Задача кластеризации. Ее решение и оценка (2 – 15 баллов) 
		2. Задача классификации, включая выбор и описание признаков, обучение (2-20) 
		3. Задача регрессии. Должна включать обработку независимых переменных (10 -20 баллов), оценку – выбор, обоснование, обучение на основе минимизации ошибки (15 баллов) 
		4. Выбор метода оценивания результата ( 2-10 баллов) 
		5. Визуализация. Сквозное задание – касается данных, постановки задачи, результатов и выводов (0 -15) 
	4. Реализация: Алгоритмы, программа, расчеты – допускается как использование программных решений, так и статистических программ. Чем выше уровень реализации, тем выше оценка (10 25 баллов) 
	5. Интерпретация и использование результатов (2-15)
	6. Заключение. Оценка: как можно оценить результат машинного обучения. Точность, достоверность. Как можно оценить ваш результат. От 5 за адекватность

[Задание на курсовую _ММ ИИ 24, page 1](Задание%20на%20курсовую%20_ММ%20ИИ%2024.pdf#page=1&selection=0,0,171,17)
# Введение
Математика - это наука об отношениях между объектами, о которых ничего не известно, кроме описывающих их некоторых свойств, - именно тех, которые в качестве аксиом положены в основание той или иной математической теории.

Моделирование - исследование объектов познания на их моделях; построение и изучение моделей реально существующих объектов, процессов или явлений с целью получения объяснений этих явлений, а также для предсказания явлений, интересующих исследователей.

Математическая модель - математическое представление реальности, один из вариантов модели как системы, исследование которой позволяет получать информацию о некоторой другой системе. Математическая модель, в частности, предназначена для прогнозирования поведения реального объекта, но всегда представляет собой ту или иную степень его идеализации.

Математическим моделированием называют как саму деятельность, так и совокупность принятых приёмов и техник построения и изучения математических моделей.

Цель данной курсовой работы: освоить методику обобщения данных, описывающих систему, методом наименьших квадратов и оценить адекватность, точность полученной модели реальной системе или ее предсказательные возможности.

# Описание данных
Исходные данные для исследования и применения методов машинного обучения представлены в файле online_sales_dataset.csv

Набор данных содержит анонимизированные данные о транзакциях онлайн-продаж, отражающие различные аспекты покупок товаров, информацию о клиентах и характеристики заказов.

Набор можно использовать для исследования тенденций в продажах, поведения покупателей и управления заказами в онлайн- или розничной торговле. Это поможет понять, как влияют скидки, способы оплаты и поставщики услуг доставки на эффективность продаж и удовлетворенность клиентов. 

Также набор можно использовать для анализа эффективности продаж, структуры покупок клиентов и операционной эффективности при управлении заказами.

Данные представлены в формате CSV (comma-separated values, значения, разделённые запятыми), что делает их удобными для дальнейшей обработки.

| InvoiceNo | StockCode | Description | Quantity | InvoiceDate      | UnitPrice | CustomerID | Country        | Discount          | PaymentMethod | ShippingCost | Category    | SalesChannel | ReturnStatus | ShipmentProvider | WarehouseLocation | OrderPriority |
| --------- | --------- | ----------- | -------- | ---------------- | --------- | ---------- | -------------- | ----------------- | ------------- | ------------ | ----------- | ------------ | ------------ | ---------------- | ----------------- | ------------- |
| 221958    | SKU_1964  | White Mug   | 38       | 2020-01-01 00:00 | 1.71      | 37039      | Australia      | 0.47              | Bank Transfer | 10.79        | Apparel     | In-store     | Not Returned | UPS              | London            | Medium        |
| 771155    | SKU_1241  | White Mug   | 18       | 2020-01-01 01:00 | 41.25     | 19144      | Spain          | 0.19              | paypall       | 9.51         | Electronics | Online       | Not Returned | UPS              | Rome              | Medium        |
| 231932    | SKU_1501  | Headphones  | 49       | 2020-01-01 02:00 | 29.11     | 50472      | Germany        | 0.35              | Bank Transfer | 23.03        | Electronics | Online       | Returned     | UPS              | Berlin            | High          |
| 465838    | SKU_1760  | Desk Lamp   | 14       | 2020-01-01 03:00 | 76.68     | 96586      | Netherlands    | 0.14              | paypall       | 11.08        | Accessories | Online       | Not Returned | Royal Mail       | Rome              | Low           |
| 359178    | SKU_1386  | USB Cable   | -30      | 2020-01-01 04:00 | -68.11    |            | United Kingdom | 1.501433043360303 | Bank Transfer |              | Electronics | In-store     | Not Returned | FedEx            |                   | Medium        |


Данные признаки можно разбить на следующие категории:
- **Категориальные признаки:**
    - `InvoiceNo`: уникальный номер счета.
    - `StockCode`: код товара.
    - `Description`: описание товара.
    - `Country`: страна покупателя.
    - `PaymentMethod`: способ оплаты.
    - `SalesChannel`: канал продаж (например, онлайн или оффлайн).
    - `ShipmentProvider`: поставщик доставки.
    - `WarehouseLocation`: местоположение склада.
    - `OrderPriority`: приоритет заказа. (высокий, средний, низкий)
    - `ReturnStatus`: статус возврата (например, "возвращен" или "не возвращен").
    - `InvoiceDate`: дата и время заказа.
- **Числовые признаки:**
    - `Quantity`: количество проданного товара.
    - `UnitPrice`: цена за единицу товара.
    - `Discount`: размер скидки.
    - `ShippingCost`: стоимость доставки.

Типы признаков разделяются на количественные и качественные [18].

Количественные признаки – это признаки, которые измеряются в числовых значениях и могут быть использованы для математических операций (сложение, вычитание и т.д.).

Качественные (категориальные) признаки – это признаки, которые описывают характеристики объектов и выражаются в виде категорий или классов. Эти признаки не могут быть измерены количественно, но их можно классифицировать. Они делятся на два подтипа:
- номинальные признаки – качественные признаки, которые представляют собой категории, не имеющие естественного порядка, например, страна клиента (Россия, Германия, Франция);
- порядковые признаки – качественные признаки, которые также представляют категории, но имеют определенный порядок или ранжирование, например, степень удовлетворенности (низкий, средний, высокий).

Среди признаков можно выделить следующие взаимосвязи:
- влияние скидок на продажи – признак `Discount` позволит понять, как применение скидок влияет на количество покупок и доходность;
- категория товара и продажа – признак `Category` позволит исследовать, какие категории товаров пользуются наибольшим спросом и какие из них чаще возвращаются;
- анализ эффективности поставщиков доставки - признак `ShipmentProvider` поможет выявить, какие поставщики наиболее эффективны, и есть ли зависимость между поставщиком и количеством возвратов;
- региональные различия в покупках – анализ признака `Country` может выявить особенности покупательского поведения в разных странах и понять, какие товары популярны в различных регионах.
В данных также можно заметить следующие ошибки:
- Некоторые ячейки пусты
- Некоторые ячейки имеют отрицательные значения тогда, когда их там быть не может (отрицательная стоимость товара или отрицательное количество)
- Аномальные значения полей 
	- скидки в промежутке между 100% и 200%,
	- количество продуктов в промежутке между 0 и -50
	- стоимость продуктов в промежутке между 0 и -99.98
Для получения корректных результатов необходимо исправить данный нам набор данных. Самым простым способом в данном случае является удаления невалидных данных, так как попытки их исправить путём изменения значений полей снизят точность результатов.

После фильтрации некорректных данных, остаётся 44804 записи из изначальных 49782 транзакций.
# Формирование признаков
Можно сформировать следующие дополнительные признаки
1. `TotalPrice`: Общая стоимость заказа, вычисляемая по формуле $TotalPrice = (Quantity \cdot{} UnitPrice) \cdot{} (1 - Discount)$
2. `Month`, `Weekday`: Признаки для улучшенной категоризации заказов по времени
4. `ShippingMargin`: Доля стоимости заказа, потраченная на доставку, вычисляется по формуле $ShippingMargin = \left(\frac{ShippingCost}{TotalPrice}\right)\cdot{} 100$
Также некоторые существующие признаки можно преобразовать для удобства обработки
1. `ReturnStatus` можно превратить из категориального (`NotReturned`/`Returned`) в бинарный `IsReturned`
2. `SalesChannel` можно превратить из категориального (`In-store`/`Online`) в бинарный `IsOnline`
3. `OrderPriority` можно превратить из категориального (`High`/`Medium`/`Low`) в числовой (0 - низкий, 1 - средний, 2 - высокий)
# Задачи машинного обучения
К основным задачам машинного обучения относятся задачи классификации, кластеризации и регрессии.

Классификация – это задача машинного обучения, направленная на определение, к какому из заранее заданных классов относится объект. Иными словами, цель состоит в том, чтобы на основе входных данных предсказать принадлежность объекта к определённой категории. Эта техника используется в задачах, где требуется разделить данные на группы, например, классифицировать пациентов как больных или здоровых в медицине, либо определять тональность отзыва (положительная или отрицательная) в анализе настроений.

Кластеризация представляет собой метод группировки объектов, при котором похожие объекты объединяются в кластеры. В отличие от классификации, здесь отсутствуют заранее заданные классы. Основная цель кластеризации — выявление структуры или закономерностей в данных, таких как группы пользователей с похожими характеристиками или товары с общими свойствами. Этот метод применяется для сегментации клиентов, анализа покупательского поведения, поиска схожих групп товаров или обнаружения аномалий.

Регрессия – это задача машинного обучения, предназначенная для прогнозирования числового значения на основе входных данных. Например, она позволяет определить сумму покупки, исходя из количества товаров, уровня скидки и категории продукта. В отличие от классификации, регрессия работает с непрерывной целевой переменной. Этот подход используется для предсказания таких числовых показателей, как объёмы продаж, температура, стоимость недвижимости и другие количественные данные.

В данном случае подходит задача классификации, так как задача сводится к предсказанию категориального признака (категории товара). Для такой задачи хорошо подходят методы классификации, которые учитывают большое количество входных признаков.

Для решения задач классификации применяются различные методы, среди которых:

**Метод ближайших соседей (K-Nearest Neighbors, KNN)**

Этот алгоритм классификации определяет принадлежность объекта к классу на основе классов ближайших объектов в пространстве признаков. KNN особенно полезен в ситуациях, когда границы между классами нечеткие, и требуется учитывать информацию о соседних объектах. Метод может применяться, например, для определения категории товара, сравнивая текущую транзакцию с предыдущими покупками аналогичных товаров.

**Логистическая регрессия**

Метод, который предсказывает вероятность принадлежности объекта к определенной категории. Он использует логистическую функцию для ограничения результатов в диапазоне от 0 до 1. Логистическая регрессия подходит для бинарных задач, таких как прогнозирование возврата товара («возврат/не возврат»). Этот метод прост в реализации и эффективен, если между признаками и целевой переменной существует линейная зависимость, например, для анализа влияния скидок, цен и количества товара на вероятность возврата.

**Деревья решений**

Алгоритмы, использующие древовидную структуру для классификации. Внутренние узлы дерева делят данные по признакам, а конечные листья представляют итоговые решения. Деревья решений хорошо подходят для задач, где результат зависит от множества факторов. Они просты для интерпретации, что позволяет легко определить наиболее значимые признаки, например, скидки или категорию товара. Эти алгоритмы эффективно работают как с числовыми, так и с категориальными признаками.

Задача кластеризации
Сегментация клиентов на основе их покупательского поведения позволяет улучшить таргетинг маркетинговых кампаний, повысить качество обслуживания и предложить персонализированные предложения. Для этого клиентов группируют по сходству их характеристик, таких как объем расходов, частота покупок и предпочтения. Кластеризация помогает выделить группы клиентов, схожих по ключевым признакам, и выявить скрытые закономерности в данных.

Для выполнения кластеризации используются следующие методики:

**Метод K-средних (K-Means)**

Алгоритм разделяет данные на KKK кластеров, минимизируя расстояние между объектами внутри кластера. Он подходит для группировки объектов по схожести, что делает его полезным для сегментации клиентов, например, по покупательскому поведению или предпочтениям. Метод позволяет быстро и эффективно выявить ключевые сегменты клиентов, которые можно использовать для таргетинга рекламных акций или персонализации предложений. Простой в реализации, этот алгоритм дает быстрые результаты при анализе данных.

**Иерархическая кластеризация**

Этот метод создает дерево кластеров, отображающее, как группы данных объединяются друг с другом. Иерархическая кластеризация полезна для задач, требующих анализа не только сегментов, но и взаимосвязей между ними. Она позволяет рассматривать данные на разных уровнях детализации, что делает её эффективным инструментом для глубокого анализа клиентских сегментов.

**DBSCAN (Density-Based Spatial Clustering of Applications with Noise)**

Алгоритм на основе плотности объединяет точки в кластеры, если они находятся достаточно близко друг к другу и образуют области высокой плотности. Точки, не относящиеся ни к одному кластеру, классифицируются как выбросы или шум. DBSCAN подходит для анализа клиентских групп с похожими характеристиками (например, типы покупок) и обнаружения аномалий, таких как мошеннические транзакции или необычные покупательские паттерны.

Задача регресии
Задача регрессии применима для оценки влияния размера скидки на итоговый объём продаж товара. Это поможет оценить важность снижения цен для получения максимальной прибыли.

Для решения задачи регрессии можно использовать следующие методы:

- Линейная регрессия – это метод, который используется для предсказания числовых значений на основе линейной зависимости между зависимой переменной (целевой) и одной или несколькими независимыми переменными (признаками). Линейная регрессия подходит для задач регрессии, где требуется предсказать числовое значение, которое зависит от множества факторов. Этот метод прост в интерпретации и хорошо работает, если данные имеют линейную зависимость. Например, линейная регрессия может быть использована для предсказания общей суммы покупки на основе таких признаков, как количество товаров, скидка, категория товара, метод оплаты и т.д. Также она может помочь в анализе того, как изменение цен, скидок или других факторов влияет на продажи.
- Градиентный бустинг – это ансамблевый метод, который строит серию слабых моделей, каждая из которых исправляет ошибки предыдущей. Он использует градиентный спуск для минимизации ошибки. Градиентный бустинг даёт отличные результаты, особенно на сложных данных с нелинейными зависимостями. Он подходит для задач классификации и регрессии, например, для предсказания возврата товаров или суммы покупки.
- Случайный лес – это ансамблевый метод, который строит множество деревьев решений и комбинирует их результаты с помощью голосования (для классификации) или усреднения (для регрессии). Каждый элемент в случайном лесе обучается на случайной подвыборке данных и случайной подвыборке признаков. Случайный лес уменьшает переобучение и повышает точность по сравнению с одиночным деревом решений. Этот метод может быть использован для решения задач классификации и регрессии в контексте транзакций и анализа покупок.
# Задача классификации
Задача классификации
В данной задаче классификации рассматривается набор данных о транзакциях онлайн-продаж. Нам нужно классифицировать товары по странам, то есть предсказать, какие предметы заказываются чаще жителями каких стран.

Целевая переменная – страна.

Для решения задачи можно использовать различные признаки, такие как:
- Quantity (количество) – это количество проданных единиц товара. Признак может быть полезен, так как более популярные товары (с большим количеством продаж) могут принадлежать определенным категориям.
- UnitPrice (цена товара) – цена товара часто зависит от категории. Например, товары в категории «Электроника» могут иметь более высокие цены, чем товары в категории «Одежда».
- ShippingCost (цена доставки) - цена доставки часто зависит от категории товара. Например, товары более хрупких категорий (например, электроника) могут иметь более высокую стоимость доставки, чем, например, одежда
- Discount (скидка) – товары с более высокими скидками могут часто быть из категории распродаж, например, «Одежда». 
- Category (категория) - нужды жителей разных стран могут быть разными
- Month и DayOfTheWeek (месяц и день недели) – сезонность и поведение покупателей могут сильно зависеть от времени года или дня недели.

Для выполнения данной задачи был выбран метод K ближайших соседей (K Nearest Neighbours, KNN). Этот метод имеет следующие плюсы:
- KNN является достаточно простым и понятным методом. Модель не требует сложных математических преобразований, и её результаты легко интерпретируются. 
- KNN хорошо работает с данными, где нет явных линейных зависимостей между признаками. Например, взаимоотношение между скидкой и возвратом товара может быть нелинейным, и KNN хорошо справляется с такими задачами.
- KNN можно адаптировать для различных типов данных, что подходит для рассматриваемой задачи с разнообразными признаками.
- Для небольших и средних объёмов данных KNN может показать хорошие результаты с минимальной настройкой.

Для выполнения классифицкации можно выбрать одну из следующих метрик

- Евклидово расстояние – это метрика, которая измеряет прямую линию между двумя точками в многомерном пространстве [8]. Оно рассчитывается по формуле (1):
d(p, q) = i=1n(pi–qi)2                                            (1)
где d – расстояние; pi и qi – координаты точек в i-том измерении;                             n – количество измерений (признаков).
- Манхэттенское расстояние – это сумма абсолютных разностей координат между двумя точками [19]. Оно рассчитывается по формуле (2):
d(p, q) = i=1n|pi–qi|                                            (2)

где d – расстояние; 
pi и qi – координаты точек в i-том измерении; 
n – количество измерений (признаков).

Для решения задачи было выбрано евклидово расстояние по следующим причинам:
- Евклидово расстояние подходит, когда признаки измеряются в схожих единицах и отражают реальные «расстояния» между объектами. Например, разница в значениях признаков таких, как цена или количество, должна интерпретироваться как прямое расстояние между точками.
- Евклидово расстояние более точно учитывает отклонения между точками, особенно если данные предварительно нормализованы.
- Манхэттенское расстояние лучше работает с дискретными или категориальными признаками, а в нашем наборе данных многие признаки (например, цена, скидка, количество) являются непрерывными. Поэтому использование манхэттенской метрики могло бы снизить точность модели
![confusion_matrix](confusion_matrix_img.png)

Количество строк и столбцов равно количеству классов. Сумма элементов каждой строки равна количеству элементов, которое на самом деле относится к данному классу. Сумма элементов каждого столбца равна количеству элементов, которое модель посчитала относящимся к данному классу. Следовательно, элементы, которые модель распознала верно, находятся на главной диагонали матрицы.

Из матрицы на рис. 4 следует, что программа верно распознала:
- 158 элементов 0 класса
- 166 элемент 1 класса
- 116 элемента 2 класса
- 105 элементов 3 класса
- 101 элементов 4 класса
- 98 элементов 5 класса
- 89 элемента 6 класса
- 58 элементов 7 класса
- 62 элементов 8 класса
- 57 элементов 9 класса
- 50 элементов 10 класса
- 41 элемента 11 класса
Лучше всего модель справилась с распознаванием элементов 1 класса. Хуже всего – с элементами 11 класса. Это может говорить о различной выразительности признаков, которые различают класс 11.

Помимо матрицы ошибок программа составила отчет по классификации

![Classification](classification_ss.png)

Precision показывает точность прогноза моделью положительного класса (корректной страны). Если precision низкий, то модель часто ошибается и предсказывает не ту страну, из которой был заказан товар

Программа показала следующие точности для разных классов:
Australia - 0.08 (8%) - только 8% прогнозов оказались верными
Belgium - 0.08 (8%) - только 8% прогнозов оказались верными
France - 0.09 (9%) - только 9% прогнозов оказались верными
Germany - 0.07 (7%) - только 7% прогнозов оказались верными
Italy - 0.09 (9%) - только 9% прогнозов оказались верными
Netherlands - 0.08 (8%) - только 8% прогнозов оказались верными
Norway - 0.08 (8%) - только 8% прогнозов оказались верными
Portugal - 0.09 (9%) - только 9% прогнозов оказались верными
Spain - 0.08 (8%) - только 8% прогнозов оказались верными
Sweden - 0.09 (9%) - только 9% прогнозов оказались верными
United Kingdom - 0.08 (8%) - только 8% прогнозов оказались верными
United States - 0.08 (8%) - только 8% прогнозов оказались верными

Recall (полнота) показывает, как хорошо модель находит все положительные примеры. Если recall для страны-заказчика низкий, это означает, что модель ошибается при предсказывании страны.

Программа показала следующие значения полноты для разных классов:
Australia - 0.15 (5%) - только 5% от всех объектов класса Australia были правильно классифицированы
Belgium - 0.13 (3%) - только 3% от всех объектов класса Belgium были правильно классифицированы
France - 0.13 (3%) - только 3% от всех объектов класса France были правильно классифицированы
Germany - 0.09 (9%) - только 9% от всех объектов класса Germany были правильно классифицированы
Italy - 0.09 (9%) - только 9% от всех объектов класса Italy были правильно классифицированы
Netherlands - 0.08 (8%) - только 8% от всех объектов класса Netherlands были правильно классифицированы
Norway - 0.06 (6%) - только 6% от всех объектов класса Norway были правильно классифицированы
Portugal - 0.07 (7%) - только 7% от всех объектов класса Portugal были правильно классифицированы
Spain - 0.05 (5%) - только 5% от всех объектов класса Spain были правильно классифицированы
Sweden - 0.05 (5%) - только 5% от всех объектов класса Sweden были правильно классифицированы
United Kingdom - 0.04 (4%) - только 4% от всех объектов класса United Kingdom были правильно классифицированы
United States - 0.04 (4%) - только 4% от всех объектов класса United States были правильно классифицированы

F1-score - это баланс между точностью и полнотой. Это важный показатель, который учитывает как ложные срабатывания, так и неправильно выбранные страны. Низкий F1-score может свидетельствовать о том, что модель либо слишком строго классифицирует страны (в результате чего много ложных отрицательных), либо слишком либерально классифицирует их (в результате чего много ложных положительных).

Программа рассчитала следующие оценки для разных классов:
Australia - 0.10 (10%)
Belgium - 0.10 (10%)
France - 0.11 (11%)
Germany - 0.08 (8%)
Italy - 0.09 (9%)
Netherlands - 0.08 (8%)
Norway - 0.07 (7%)
Portugal - 0.08 (8%)
Spain - 0.06 (6%)
Sweden - 0.07 (7%)
United Kingdom - 0.06 (6%)
United States - 0.05 (5%)

Macro avg (макро-среднее) вычисляется как среднее всех показателей для каждого класса, без учета их частоты:
- Precision: 0.08 – модель в среднем правильно предсказывает 8% объектов для каждого класса;
- Recall: 0.08 – lля каждого класса модель в среднем правильно определяет только 8% истинных объектов;
- F1-score: 0.08 – низкая общая эффективность.

Weighted avg (взвешенное усреднение) учитывает количество примеров для каждого класса:
- Precision: 0.08 – даже с учетом количества данных по каждому классу, точность модели не улучшается.
- Recall: 0.08 – модель плохо предсказывает классы даже при учете их пропорций;
- F1-score: 0.08 – также свидетельствует о том, что модель неточная.

Accuracy (точность модели) равна 0,2. Это указывает, что модель верно классифицирует лишь 20% объектов. Показатель невысокий, что говорит о проблемах с качеством модели. Точность вычисляется по формуле.

$$
Accuracy = \frac{Количество\;верно\;предсказанных\;объектов}{Общее\;количество\;объектов }
$$

В ходе классификации категории товаров с использованием алгоритма KNN модель продемонстрировала низкую точность. Это можно объяснить несколькими объективными причинами:
- Сильная несбалансированность классов – категории товаров представлены неравномерно. Это приводит к тому, что модель «склоняется» к предсказанию доминирующих классов, игнорируя менее частые категории;
- Неудачный выбор признаков – выбранные признаки могут недостаточно четко различать категории товаров;
- Категории товаров могут не зависеть напрямую от выбранных признаков. Например, клиент может купить аксессуары или электронику в схожих условиях (по цене, скидке или времени покупки), и это делает задачу предсказания категорий крайне трудной;
- Возможно, данные содержат значительные перекрытия между классами. Товары из разных категорий могут иметь похожие цены или скидки, что делает их трудными для различения;
    

Чтобы улучшить качество классификации и повысить точность модели, можно предпринять следующие шаги:
- Использовать методы балансировки данных – увеличение редких классов, например, метод SMOTE для добавления точек редких классов, или наоборот уменьшение частых классов – удаление некоторых точек из доминирующих классов, чтобы уравновесить данные. Это необходимо для предотвращения ситуации, когда модель обучается лучше на доминирующих классах и игнорирует редкие, как было в нашем случае;
- Выделить новые признаки, которые могут лучше отражать закономерности. Например, вместо месяцев можно использовать времена года, а вместо точных значений скидок их категории – низкая, средняя, высокая. Преобразование признаков помогает сделать данные более интерпретируемыми для модели и улучшить её способность выявлять зависимости;
- Если категории товаров слишком маленькие и сильно пересекаются, их можно объединить;
- Проверить, насколько классы пересекаются. Если пересечение сильное – проводить классификацию по такой целевой переменной не имеет смысла, необходимо выбрать другую;
- Если модель KNN не дает хороших результатов, можно попробовать более сложные модели: логистическую регрессию, случайный лес, градиентный бустинг и др.

# Задача кластеризации
Кластеризация клиентов на основе их покупательского поведения позволяет группировать пользователей по схожим характеристикам для оптимизации бизнес-процессов и повышения эффективности маркетинговых кампаний. Главная цель задачи заключается в том, чтобы сгруппировать клиентов по схожести их покупок, объемов расходов, частоте покупок и других значимых характеристик.

Для задачи кластеризации целесообразно использовать алгоритм K-means, который позволяет разделить данные на k кластеров по признаку схожести. Этот метод хорошо подходит для группировки объектов с числовыми характеристиками.

Преимущества данного метода:

- простота реализации и интерпретации;
    
- эффективен на больших наборах данных с числовыми признаками;
    
- позволяет заранее задать количество кластеров.
    

Для кластеризации клиентов могут использоваться следующие признаки:

- Quantity (количество проданных товаров) – для оценки частоты и объема покупок;
    
- UnitPrice (цена за единицу товара) – влияет на средний чек и прибыль;
    
- TotalDiscount (сумма скидок) – поможет определить, как скидки влияют на клиентов;
    
- Category (категория товара) – показывает предпочтения клиентов по типу товаров;
    
- SalesChannel (место совершения покупки) – выявляет различия в покупательском поведении через разные каналы;
    
- ReturnStatus (статус возврата) – анализ возвратов для определения лояльности клиентов;
    
- OrderPriority (приоритет заказа) – поможет определить клиентов с высокими требованиями;
    
- Month (месяц покупки) – для анализа сезонных трендов;
    
- DayOfTheWeek (день недели) – для анализа предпочтений покупателей в определенные дни недели.
    

В отличие от задач классификации и регрессии, в кластеризации отсутствует целевая (зависимая) переменная. Алгоритм самостоятельно находит группы (кластеры) на основе схожести значений независимых переменных.


![Clusterisation data](clusterisation_ss.png)

Кластеризацию будем производить с использованием средств языка программирования Python.

Для определения количества кластеров программа подсчитывает силуэтные коэффициенты для каждого числа кластеров (от 2 до 9). Силуэтный коэффициент измеряет, насколько хорошо каждый объект в выборке кластеризуется в своем кластере, по сравнению с другими кластерами. Он варьируется от -1 до 1, где -1 означает, что объект был неправильно отнесен к своему кластеру, 0 указывает, что объект находится на границе 2 кластеров, а 1 означает, что объект идеально относится к своему кластеру.

Границы от 2 до 9 выбраны по следующим причинам:

- чтобы провести кластеризацию, необходимо хотя бы 2 кластера, поэтому минимальное количество кластеров – 2;
    
- диапазон необходимо ограничить, чтобы не создавать слишком много кластеров, что может привести к излишней детализации. При большом числе кластеров данные начинают дробиться, и количество кластеров становится малозначимым для реального анализа. В качестве максимального значения было выбрано 9 кластеров.
    

В ходе расчетов программа выбрала 8 кластеров, так как при них достигается наивысшее значение силуэтного коэффициента – 0,22.

#REWRITE

# Задача регрессии
Прогнозирование вероятности возврата покупки – важная задача для анализа продаж, управления запасами и повышения прибыли компании. Основная цель – создать модель, которая будет предсказывать вероятность возврата на основе различных факторов, таких как количество товара, цена, скидки, категория, страна. 

Для решения задачи регрессии, заключающейся в прогнозировании суммы покупки, мы выбираем метод линейной регрессии. Линейная регрессия – это один из самых популярных и простых методов машинного обучения, используемый для анализа зависимостей между одной зависимой переменной (целевой) и одной или несколькими независимыми переменными (признаками). Этот метод предполагает, что существует линейная связь между переменными, что делает его удобным и интерпретируемым инструментом для анализа данных.

Преимущества линейной регрессии:

- Простота и интерпретируемость: линейная регрессия дает четкую зависимость между целевой переменной и признаками. Модель позволяет легко понять, как изменение каждого признака влияет на итоговую сумму покупки.
    
- Быстрота обучения: линейная регрессия требует относительно небольших вычислительных ресурсов, что позволяет быстро обучать модель даже на больших объемах данных.
    
- Малые требования к данным: линейная регрессия не требует сложной настройки и хорошо работает при отсутствии сильно выраженных зависимостей между признаками. Она также позволяет легко работать с многомерными данными.
    

Целевой переменной в данной задаче будет сумма покупки (TotalCost), то есть общая сумма, которую клиент тратит в рамках одной транзакции.

Для задачи прогнозирования суммы покупки будем учитывать следующие признаки:

- Количество товара (Quantity) – это количество единиц товара, купленных в одной транзакции. Чем больше единиц товара, тем больше вероятность того, что сумма покупки будет выше. Этот признак напрямую связан с целевой переменной.
    
- Цена товара (UnitPrice) – играет важную роль в определении итоговой суммы. Чем выше цена, тем больше сумма покупки.
    
- Скидка (Discount) – может значительно повлиять на итоговую цену покупки. Зачастую скидки используются для стимулирования продаж, и их наличие или величина может оказывать существенное влияние на общую сумму.
    
- Категория товара (Category) – может включать различные типы продукции, которые могут иметь разные ценовые диапазоны. Этот признак поможет учесть различия в ценах и объемах продаж между категориями товаров.
    
- Тип канала продажи (SalesChannel) – может повлиять на цену товара и количество покупок. 
    
- Статус возврата (ReturnStatus) – может быть полезным для анализа покупок с возвратами. Покупатели, которые часто возвращают товар, могут влиять на прогнозируемую сумму.
    
- Месяц (Month) – время года или месяц может влиять на сумму покупки из-за сезонных распродаж, праздников и других факторов. Например, в праздничные месяцы продажи могут быть выше.
    
- День недели (DayOfTheWeek) – покупки могут зависеть от дня недели, особенно если речь идет о распродажах, которые чаще проходят в выходные.
    
- Страна (Country) – местоположение может существенно влиять на покупки в зависимости от региона. Например, в одном регионе товары могут быть более популярными, чем в другом.
    

Перед тем как применить метод линейной регрессии, нужно подготовить и преобразовать данные в подходящий формат для обучения. Некоторые признаки в наборе данных являются категориальными. Для того чтобы применить метод линейной регрессии, нам нужно преобразовать эти категориальные данные в количественные.

Для преобразования будем использовать 2 метода:

- Label Encoding – для категориальных признаков, принимающих 2 значения (SalesChannel, ReturnStatus). Одному из признаков будет присвоено значение 0, а другому – 1 [23]. 
    
- One-Hot Encoding – для категориальных признаков, принимающих более 2 различных значений (Country, Category, Month, DayOfTheWeek). Каждый уникальный категориальный признак будет представлен отдельным столбцом, где для каждого значения будет стоять 1 или 0, в зависимости от того, является ли это значением данного столбца [24].