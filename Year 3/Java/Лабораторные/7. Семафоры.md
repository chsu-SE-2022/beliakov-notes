Разработать многопоточное приложение. Использовать возможности, предоставляемые пакетом java.util.concurrent. Все сущности, желающие получить доступ к ресурсу, должны быть потоками. Приложение может быть консольным.

5. Автобусные остановки. На маршруте несколько остановок. На одной остановке может останавливаться несколько автобусов одновременно, но не более заданного числа.

# Исходный код
```java
package org.example;  
  
import java.io.IOException;  
import java.util.ArrayList;  
import java.util.Scanner;  
import java.util.concurrent.Semaphore;  
import java.util.Random;  
  
class BusStop {  
    private final String name;  
    private final Semaphore slots; // Ограничивает количество автобусов на остановке  
    private final int capacity;  
  
    public BusStop(String name, int capacity) {  
        this.name = name;  
        this.capacity = capacity;  
        this.slots = new Semaphore(capacity); // Максимум capacity автобусов одновременно  
    }  
  
    public void arrive(int busNumber) {  
        try {  
            System.out.println("... Автобус #" + busNumber + " подъезжает к остановке '" + name + "'");  
            slots.acquire(); // Занимаем место на остановке  
            System.out.println(">>> Автобус #" + busNumber + " остановился на '" + name + "' (свободно мест: " + slots.availablePermits() + "/" + capacity + ")");  
        } catch (InterruptedException e) {  
            System.out.println("InterruptedException caught");  
        }    }  
    public void depart(int busNumber) {  
        try {  
            // Симулируем время стоянки  
            Thread.sleep(new Random().nextInt(1000) + 500);  
        } catch (InterruptedException e) {  
            System.out.println("InterruptedException caught");  
        }        slots.release(); // Освобождаем место  
        System.out.println("<<< Автобус #" + busNumber + " отъезжает от '" + name + "' (свободно мест: " + slots.availablePermits() + "/" + capacity + ")");  
    }  
    public String getName() {  
        return name;  
    }}  
  
class Bus implements Runnable {  
    private final int busNumber;  
    private final ArrayList<BusStop> route; // Маршрут - массив остановок  
  
    public Bus(int busNumber, ArrayList<BusStop> route) {  
        this.busNumber = busNumber;  
        this.route = route;  
        new Thread(this, "Bus-" + busNumber).start();  
    }  
    public void run() {  
        System.out.println("=== Автобус #" + busNumber + " начал маршрут ===");  
  
        for (BusStop stop : route) {  
            stop.arrive(busNumber);  
            stop.depart(busNumber);  
        }  
        System.out.println("=== Автобус #" + busNumber + " завершил маршрут ===\n");  
    }}  
  
public class Main {  
    public static void main(String[] args) throws IOException {  
        // Создаем остановки с разной вместимостью  
        final Scanner scanner = new Scanner(System.in);  
        System.out.println("Введите количество остановок");  
        int stops = scanner.nextInt();  
        ArrayList<BusStop> route = new ArrayList<>();  
  
        for (int i = 1; i < stops + 1; i++) {  
            System.out.println("Введите название остановки " + i);  
            String stopName = scanner.next();  
            System.out.println("Введите вместимость остановки " + i);  
            int stopCapacity = scanner.nextInt();  
            route.add(new BusStop(stopName, stopCapacity));  
        }  
        System.out.println("Введите количество автобусов");  
        int busCount = scanner.nextInt();  
        System.out.println("Начало симуляции автобусного маршрута\n");  
  
        for (int i = 1; i < busCount + 1; i++) {  
            new Bus(i, route);  
        }  
        try {  
            Thread.sleep(8000);  
        } catch (InterruptedException e) {  
            e.printStackTrace();  
        }  
        System.out.println("\nСимуляция завершена");  
    }}
```

# Алгоритм
Каждая остановка держит семафор для количества автобусов, которые могут у неё остановиться. Каждые подъезжающий автобус пытается acquire() слот, если их нет, то автобус стоит. Отъезжающий автобус место освобождает. Каждый автобус это отдельный поток
# Пример
![[Assets/Pasted image 20251113144212.png]]