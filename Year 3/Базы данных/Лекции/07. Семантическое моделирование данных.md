Реляционных БД достаточно для моделирования большинства предметных областей, но при реальном проектировании обнаруживается их ограниченность. У моделей недостаточно средств для отображения смысла данных. Трудно моделировать предметную область на основе плоских таблиц
Проектирование - выделение сущностей и связей между ними, модель не предлагает аппарата для их разделения
В развитии реляционной модели появилась семантическая модель данных Entity-relationship (ER). Авторство приписывают
Моделирование предметной области базируется на графических диаграммах
Основные понятия - сущность, связь, атрибут
Сущность - реальный (или представляемый) объект, информация о котором хранится. Изображается прямоугольником, внутри которого - имя сущности, при этом имя сущности = имя типа, не имя экземпляра.
Связь - Графически изображаемая ассоциация, устанавливаемая между двумя сущностями. Считается бинарной. На концах указывается имя конца связи, степень конца связи (сколько экземпляров сущности связывается), обязательность связи (любой экземпляр сущности должен участвовать в связи)

Каждый билет предназначен только для одного пассажира. Каждый пассажир может иметь 1+ билетов

Атрибут - любая деталь/характеристика, которая служит для идентификации, численной характеристики, выражения состояния, уточнения сущности

Уникальный идентификатор (UID) - атрибут/комбинация, однозначно отличающие любой экземпляр сущности от других экземпляров сущности. 

# Первая экспериментальная реляционная БД "SystemR"
Придумана IBM в 1975-1979 годах
## Управление транзакциями
Транзакция - такая неделимая с точки зрения воздействия на БД последовательность операторов, либо результаты всех операторов, входящих в транзакцию, отображаются в БД, либо воздействие отсутствует.
"Лозунг" транзакции - "Всё или ничего". При завершении транзакции оператором `COMMIT` результаты записываются в ПЗУ, оператором `ROLLBACK` - всё отменяется. Транзакции обеспечивают целостность баз данных и изолированность пользователей. Иногда целостность нельзя не нарушить, поэтому состояние нецелостности допускается внутри транзакции. Различают два вида ограничений целостности - немедленно проверяемое (невозможно откладывать, реализуется оператором высокого уровня, при этом не вся транзакция отменяется) и откладываемое (ограничение на базу данных, а не на операции. Проверяется в конце транзакции, автоматически проводит `ROLLBACK`)
### Изолированность пользователей
Транзакции обеспечивают изолированность пользователей - создаётся иллюзия того, что каждый работает с базой данных в одиночку, транзакция выступает как единица изолированности пользователя. Существует три уровня изолированности
### Отсутствие потерянных изменений
Ситуация - Т1 изменяет объект А базы данных. До завершения Т1 Т2 также изменяет объект А. Тогда при повторном чтении объекта Т1 не видит изменений объекта, произведённых ранее. Это противоречит требованию изолированности пользователей.
Профилактика - до завершения Т1, никакая другая не может изменять объект. Отсутствие отдельных изменений - минимальное требование СУБД к параллельно-выполняемым транззакциям
### Отсутствие чтения грязных данных (проблема промежуточных данных)
Ситуация - Т1 изменяет объект А. Параллельно с этим Т2 читает объект. Так как операция изменения не завершена, Т2 видит несогласованные (грязные) данные
Диагноз - несоответствие требованию изолированности - каждый пользователь начинает свою транзакцию при согласованном состоянии БД
### Отсутствие неповторяющихся чтений
Т1 читает объект. До завершения Т1 Т2 изменяет объект и успешно завершает транзакцию
До завершения первой транзакции никакая другая не должна изменять объект
### Проблема кортежей-фантомов
Т1 выполняет оператор выборки кортежа отношения R с условием выборки S. До завершения Т1 Т2 вставляет в отношение R новый кортеж, удовлетворяющий S, и успешно завершается. В результате Т1 не видит новый кортеж
Диагноз: противоречит изолированности
Профилактика: Требуется более высокий уровень синхронизации транзакций

# Сериализация транзакций
Чтобы добиться изолированности транзакций, в СУБД есть методы совмместного их регулирования. К таковым относится сериализация - механизм выполнения транзакций. Результат совместного выполнения транзакций эквивалентен результату некоторого последовательного выполнения этих транзакций. Метод сериализации основывается на реализации трёх конфликтов:
1. W-W (Т1 и Т2 изменяют один объект)
2. R-W (Т2 пытается изменить объект, прочитанный Т2)
3. W-R (Т2 читает объект, изменённый Т1)
## Методы синхронизации
### Метод синхронизационных захватов
Перед выполнением операций над объектом, от имени транзакции запрашивается синхронизационный захват
Совместный режим (S) - разделяемый захват объекта, требуется для чтения
...
Захваты объектов по R совместимы
Захват по R не совместим с захватом по W
Захват по W не совместим с захватом по R

Что считать объектом для захвата?
Файл - физический объект, где хранятся несколько отношений
Отношение - логический объект с множеством кортежей
Кортеж - мельчайший объект базы данных
Страница данных - физический объект, который хранит кортежи одного или нескольких отношений и индексную, служебную информацию
Операция над кортежем = операция над страницей, отношением и файлом. Чем крупнее объект СЗ, тем меньше этих СЗ будет поддерживаться и на них будет меньше расходов, но возрастает вероятность конфликтов между транзакциями

Есть ещё гранулированные СЗ

Тупики:
Выполнение СЗ-ов приводит к тупикам.
Т1 и Т2 устраивают монопольные захваты объектов А1 и А2 соответственно. После этого Т1 требует совместный захват А2, Т2 - А1. Ни один из монопольных захватов не будет снят, а совместные не будут удовлетворены. Обнаруживают тупики через граф ожидания транзакций. По этому графу обнаруживаются циклы
### Метод временных меток

# Журнализация изменений БД
Для восстановления после программных и аппаратных сбоев поддерживается журнал изменений БД.
Восстановления требуются, если 
- Индивидуальный откат транзакций: завершение оператором `ROLLBACK`, откат транзакции по инициативе СУБД, исключительные ситуации в программе. Происходит выбор транзакции в качестве жертвы
- Потеря содержимого оперативной памяти при сбое
- При сбое процессора
- Поломка ПЗУ
В основе восстановления - хранение избыточных данных в журнале изменений БД и в архивной копии